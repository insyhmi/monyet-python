<!--Use active-win system for tracking current tabs-->

<!DOCTYPE html>
<html>
  <head>
    <title>Procrastination Detector</title>
  </head>
  <body>
    <h1>Hello, Procrastinator!</h1>
    <p>Focus detected soon...</p>
    <p>Name your current task: </p>
    <input id="task">
    <button id="start">Start Tracking</button>
    <button id="stop">Stop Tracking</button>
    <pre id="output"></pre>
    <pre id="procrastination-label"></pre>

    <script>
      const output = document.getElementById('output');
      const procrastinationLabel = document.getElementById('procrastination-label');
      const activityLog = {}; // Dictionary to store activity by app name

      // Sends request to track
      document.getElementById('start').onclick = async () => {
        // Gets task input
        const taskInput = document.getElementById('task').value.trim();
        if (!taskInput) {
          alert("Please enter your current task before starting tracking.");
          return;
        }

        // Sends the task to start tracking
        window.api.startTracking(taskInput);
        output.textContent = 'Started tracking...';
      };
      
      // Sends request to stop tracking
      document.getElementById('stop').onclick = () => {
        window.api.stopTracking();
        output.textContent = 'Stopped tracking.';
      };


      window.api.onWindowData(({ activeWindow, analysis }) => {
        // No active window
        if (!activeWindow || !activeWindow.owner || !activeWindow.owner.name) return;

        const appName = activeWindow.owner.name;
        const timestamp = new Date().toLocaleString();

        // Array version
        if (!activityLog[appName]) {
          activityLog[appName] = [];
        }

        activityLog[appName].push({
          title: activeWindow.title || 'No title',
          url: activeWindow.url || 'N/A',
          time: timestamp
        });


        // Show latest app data
        const appData = {
          title: activeWindow.title || "No title",
          url: activeWindow.url || 'N/A',
        };

        output.textContent = JSON.stringify(appData, null, 2);
        // Procrastination analysis
        procrastinationLabel.textContent = analysis.isProcrastinating
          ? `Procrastinating (score: ${analysis.score.toFixed(2)})`
          : `Productive (score: ${analysis.score.toFixed(2)})`;
      });


    </script>
  </body>
</html>
